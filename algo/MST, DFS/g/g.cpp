/*
no dont look
                                      ▓▓▓▓▓▓  ▓▓▓▓▓▓
                                      ▓▓  ░░▓▓▓▓  ▓▓▓▓▓▓
                                ▓▓▓▓▓▓▓▓░░  ░░▓▓░░░░▓▓▓▓  ▓▓
                              ▒▒▓▓░░  ▓▓░░░░░░░░░░░░▓▓░░░░▓▓
                                  ▒▒░░  ░░░░░░░░░░░░░░░░▓▓▓▓▒▒
                                  ▓▓░░░░░░░░░░░░░░░░░░░░▓▓░░▓▓
                ██████████    ▒▒▓▓░░░░▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░░▓▓
            ██████      ██████    ▓▓▓▓▓▓▓▓▓▓▓▓▒▒    ▒▒▒▒▒▒▓▓▓▓
          ████              ████████▓▓▓▓▓▓▓▓▓▓▒▒    ▒▒  ▒▒▓▓
        ████                  ██████░░  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓
                          ██████████░░  ░░░░░░██░░░░░░████
                    ██████████    ██░░░░░░░░░░▒▒░░░░░░▒▒██
              ██████████          ██░░░░░░░░░░░░░░░░░░░░██
        ██████████                  ████░░░░░░░░░░░░░░░░██
      ██████                          ████░░░░░░▒▒▒▒░░██
    ████                              ██▓▓██░░░░░░░░██
  ████                          ████████▓▓▓▓████████
  ██                          ████▓▓▓▓▓▓████████▓▓██████
  ██                        ████▓▓▓▓▓▓▓▓▓▓██████▓▓██▓▓▓▓██
                          ▓▓████▓▓▓▓██▓▓▓▓▓▓▓▓██▓▓██▓▓██▓▓▓▓
                        ████████▓▓▓▓██▓▓▓▓▓▓▓▓██▓▓██▓▓██▓▓██
                      ██▓▓▓▓▓▓▓▓████████████████▓▓██████▓▓██
                      ██▓▓██▓▓▓▓████▒▒░░░░  ░░░░▓▓██▒▒██▓▓██
                    ██▓▓▓▓██████████▒▒  ░░░░    ▓▓██▒▒██▓▓████
                    ██▓▓▓▓▓▓████  ██▒▒░░    ░░░░▓▓██▒▒▒▒██████
                  ██▓▓▓▓▓▓▓▓██    ██▒▒░░░░      ▓▓██▒▒▒▒██▓▓██
                  ██▓▓▓▓▓▓▓▓██    ██▒▒░░░░░░░░░░░░▓▓██▒▒██▓▓██
                ██▓▓▓▓████▓▓██    ████▒▒░░    ░░░░▓▓██▒▒██▓▓▓▓██
                ██▓▓██░░░░██        ████████▓▓▓▓▓▓▓▓████████▓▓▓▓████
                  ██░░░░████        ████████████████████████▓▓████░░████
                ██░░░░░░░░██        ██▒▒░░░░░░░░░░░░░░░░████▓▓██░░░░░░░░██
                ██░░░░░░░░░░██      ██░░    ░░░░░░░░░░░░░░░░████░░░░░░░░██
                ██░░░░░░░░░░██      ██▒▒░░░░    ░░░░██░░░░░░████░░░░░░██
                ██░░░░░░░░██      ██▒▒  ▒▒▒▒▒▒░░░░░░██░░░░░░░░████████
                  ████████        ██████    ▒▒▒▒████░░████░░░░██
                                  ██    ████▒▒██  ████▒▒▒▒▒▒▒▒░░██
                                ██░░░░░░  ▒▒▒▒██    ██▒▒▒▒▒▒▒▒░░░░██
                                ██░░░░░░▒▒▒▒██        ██▒▒▒▒▒▒▒▒░░██
                              ██░░░░░░▒▒▒▒▒▒██        ██▒▒▒▒▒▒▒▒░░██
                            ██░░░░░░░░▒▒▒▒██            ██▒▒▒▒▒▒▒▒░░██
                            ██░░░░░░▒▒▒▒▒▒██            ██▒▒▒▒▒▒▒▒░░██
                          ██░░░░░░▒▒▒▒▒▒██              ██▒▒▒▒▒▒░░░░██
                        ██░░░░░░▒▒▒▒▒▒██                ██▒▒▒▒▒▒▒▒░░██
                        ██░░░░░░▒▒▒▒▒▒██                ██▒▒▒▒▒▒▒▒░░██
                          ██░░▒▒▒▒▒▒██                    ████████████
                        ████████████                        ████████
                        ██▓▓▓▓████                          ██▓▓▓▓██
                      ████████████                        ██▓▓██████████
                    ██▓▓▓▓▓▓▓▓██                          ██▓▓▓▓▓▓▓▓▓▓▓▓████
                  ██▓▓▓▓▓▓▓▓▓▓██                          ██████▓▓▓▓▓▓░░░░░░██
                ██▓▓░░░░░░░░████                                ██████████████
                ██████████████
 */
 // #pragma comment(linker, "/STACK:10485760")
#define _CRT_SECURE_NO_WARNINGS

#include <array>
#include <vector>
#include <iostream>
#include <sstream>
#include <algorithm>
#include <fstream>
#include <functional>
#include <memory>
#include <set>
#include <unordered_map>
#include <map>
#include <cstdint>

using uint = std::uint32_t;
using size_type = std::uint32_t;
using graph_t = std::vector<std::vector<size_type>>;

int main(void)
{
	size_type n = 0, m = 0;

	scanf("%i %i\n", &n, &m);

	std::function<size_type(size_type)> negate_vert = [n](size_type i) {
		if (i >= n)
			return i - n;
		else
			return i + n;
	};

	std::function<size_type(bool, size_type)> sign_to_base = [n](bool s, size_type i) {
		return s * n + i;
	};

	graph_t graph(2 * n), reversed(2 * n);
	// bimap
	std::unordered_map<std::string, size_type> mapper;
	std::vector<std::string> bmapper;
	bmapper.reserve(n);

	for (size_type i = 0; i < n; i++)
	{
		char buf[20];
		scanf("%s\n", buf);
		mapper[buf] = i;
		bmapper.emplace_back(buf);
	}

	std::function<void(size_type, size_type)> put = [&](size_type u, size_type v) {
		graph[u].emplace_back(v);
		reversed[v].emplace_back(u);
	};

	for (size_type i = 0; i < m; i++)
	{
		char
			n1s[20], n2s[20];
		scanf("%s => %s", n1s, n2s);
		size_type
			n1 = mapper[n1s + 1],
			n2 = mapper[n2s + 1];
		// a -> b == (!a | b) == (!!a -> b) & (!b -> !a)
		bool
			s1 = n1s[0] == '-',
			s2 = n2s[0] == '-';

		put(sign_to_base(s1, n1), sign_to_base(s2, n2));
		put(sign_to_base(!s2, n2), sign_to_base(!s1, n1));
	}

	std::vector<bool> visited(2 * n, false);
	// pseudotopo
	std::vector<size_type> order;
	{
		std::function<void(size_type)> dfs = [&](size_type cur) {
			if (visited[cur])
				return;
			visited[cur] = true;
			for (const auto &v : graph[cur])
				dfs(v);
			order.emplace_back(cur);
		};
		for (size_t i = 0; i < visited.size(); i++)
			dfs(i);
	}

	// ...
	std::reverse(order.begin(), order.end());

	// components
	std::vector<size_type> component(2 * n, 0);
	{
		size_type nextc = 0;
		std::function<void(size_type, size_type)> dfs = [&](size_type cur, size_type col) {
			if (component[cur] != 0)
				return;
			component[cur] = col;
			for (auto const& v : reversed[cur])
				dfs(v, col);
			
		};
		for (auto const& i : order)
			dfs(i, ++nextc);
	}

	std::vector<size_type> answer;
	answer.reserve(n);

	for (size_type i = 0; i < n; i++)
		if (component[i] == component[i + n])
		{
			printf("-1\n");
			return 0;
		}
		else if (component[i] > component[i + n])
			answer.emplace_back(i);

	printf("%u\n", answer.size());

	for (auto const& a : answer)
		printf("%s\n", bmapper[a].c_str());

	return 0;
}